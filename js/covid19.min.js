var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}};function COVID19(){var confirmedUSDataUrl="https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_US.csv",confirmedGlobalDataUrl="https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_global.csv",fatalUSDataUrl="https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_deaths_US.csv",fatalGlobalDataUrl="https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_deaths_global.csv";function SliceData(x,startIndex,endIndex){return endIndex<x.length?x.slice(startIndex,endIndex):x.slice(startIndex)}var chartOptions={confirmed:{type:"line",getDescription:function(location,options){var currentCases,percentage;return location.GetPopulation()?(location.GetRange("confirmed",options.startDateIndex,options.endDateIndex)/location.population*100).toFixed(2)+"% of Population":null}},default:{type:"bar",getDescription:function(location,options,data){return"Total: "+data[data.length-1]}},DerivativeData:{type:"bar",getDescription:function(location,options,data){var sum=0,average;return data.forEach((function(x){return sum+=x})),"Avarage: "+(sum/data.length).toFixed(2)}},RatioData:{type:"bar",getDescription:function(location,options,data){var total=0;data.forEach((function(x){return total+=x}));var average=total/data.length,percentage=100*average;return"Average Ratio: "+average.toFixed(2)+" ("+percentage.toFixed(2)+"%)"},isRatio:!0}},timeKey="TimeData",ratioKey="RatioData",derivativeKey="`",MyLocation=function(){function MyLocation(locationData,dataKey,indexes){var possibleNames;if(this.data={},this.dataKeys=[],this.children={},locationData.length>4){var numStartIndex=indexes[0],latitudeIndex=indexes[1],longitudeIndex=indexes[2],stateIndex=indexes[3],countryIndex=indexes[4],cityIndex=indexes[5],populationIndex=indexes[6];possibleNames=[cityIndex,stateIndex,countryIndex].filter((function(x){return x>=0})).map((function(x){return locationData[x]})).filter((function(x){return x})).map((function(x){return x.replace(/;/g,",")})),this.latitude=parseInt(locationData[latitudeIndex]),this.longitude=parseInt(locationData[longitudeIndex]),this.population=0,populationIndex&&(this.population=parseInt(locationData[populationIndex])),this.data[dataKey]=locationData.slice(numStartIndex).map((function(x){return parseInt(x)}))}else possibleNames=locationData;this.name=possibleNames[0],this.key=possibleNames.join(", "),this.names=["All"]}return MyLocation.prototype.GetData=function(key,options){var _this=this,data;if(this.dataKeys.indexOf(key)<0&&this.dataKeys.push(key),key.substr(-ratioKey.length)==ratioKey)return this.GetRatioData(key,options);if(this.data[key]&&-1==key.indexOf(ratioKey))return this.populationChecked||this.GetPopulation(),this.data[key];if(key.substr(-timeKey.length)==timeKey){var parentKey=key.substr(0,key.length-timeKey.length);return this.GetTimeData(parentKey,options)}if("`"==key.substr(-"`".length)){var parentKey=key.substring(0,key.length-"`".length);return this.GetDerivedData(parentKey,options)}return this.populationChecked=!0,this.population=0,this.names.filter((function(x){return"All"!=x})).forEach((function(x){var childData=_this.children[x].GetData(key);data?childData.forEach((function(val,i){return data[i]+=val})):data=childData.map((function(x){return x})),_this.population+=_this.children[x].GetPopulation()})),this.data[key]=data,this.data[key]},MyLocation.prototype.GetDerivedData=function(key,options){for(var data=this.GetData(key,options),derivedData=[],i=1;i<data.length;i++){var temp=data[i]-data[i-1];derivedData.push(temp)}return this.data[key+"`"]=derivedData,this.data[key+"`"]},MyLocation.prototype.GetTimeData=function(key,options){for(var data=this.GetData(key,options),timeData=[],i=1;i<data.length;i++){var temp=data[i]-data[i-1];timeData.push(temp>0?temp:0)}return this.data[key+"TimeData"]=timeData,this.data[key+"TimeData"]},MyLocation.prototype.GetRatioData=function(key,options){var keys=key.substr(0,key.length-ratioKey.length).split(";");if(keys.length>2){var i=void 0,temp1="";for(i=0;i<keys.length/2;i++)temp1+=keys[i]+";";temp1=temp1.substr(0,temp1.length-1);for(var temp2="";i<keys.length;i++)temp2+=keys[i]+";";keys=[temp1,temp2=temp2.substr(0,temp2.length-1)]}var data1=this.GetData(keys[0],options),data2=this.GetData(keys[1],options);this.data[key]=[];for(var range=options.range,offset=options.offset,i=0;i<=Math.min(data1.length,data2.length)-range-offset;i++){var d1=data1.slice(i,i+range).reduce((function(a,b){return a+b})),d2=data2.slice(i+offset,i+offset+range).reduce((function(a,b){return a+b})),ratio=d2?d1/d2:d1;this.data[key].push(ratio)}return this.data[key]},MyLocation.prototype.GetPopulation=function(){var _this=this;return this.populationChecked||this.population?this.population:(this.populationChecked=!0,this.population=0,this.names.filter((function(x){return"All"!=x})).forEach((function(x){_this.population+=_this.children[x].GetPopulation()})),this.population)},MyLocation.prototype.GetRange=function(key,startIndex,endIndex){endIndex>=this.GetData(key).length&&(endIndex=this.data[key].length-1);var range=startIndex>0?this.data[key][endIndex]-this.data[key][startIndex-1]:this.data[key][endIndex];return range>0?range:startIndex>0?this.data[key][startIndex-1]:0},MyLocation}();function randomColorString(){function randRGB(){return Math.floor(255*Math.random())-1}return"rgb("+randRGB()+","+randRGB()+","+randRGB()+")"}var MyChart=function(){function MyChart(key,name,location,options){var _a;this.key=key,this.name=name,this.id=Date.now(),this.description=null,ko.track(this),this.options=null!==(_a=chartOptions[key])&&void 0!==_a?_a:key.substr(-ratioKey.length)==ratioKey?chartOptions.RatioData:"`"==key.substr(-"`".length)?chartOptions.DerivativeData:chartOptions.default;var self=this;setTimeout((function(){self.createChart(),self.update(location,options)}),0)}return MyChart.prototype.createChart=function(){var ctx=document.getElementById(this.key+this.id),color=randomColorString();this.chart=new Chart(ctx,{data:{datasets:[{backgroundColor:color,borderColor:color}]},type:this.options.type,options:{legend:{display:!1}}})},MyChart.prototype.update=function(location,options){var data=SliceData(location.GetData(this.key,options),options.startDateIndex,options.endDateIndex);this.chart.data.datasets[0].data=data,this.options.getDescription&&(this.description=this.options.getDescription(location,options,data)),this.chart.data.labels=SliceData(chartDates,options.startDateIndex,options.startDateIndex+data.length),this.chart.update()},MyChart}(),ChartGroup=function(){function ChartGroup(vm){this.id=vm.lastID++,this.selectedCountryName="",this.selectedStateName="",this.selectedCityName="",this.selectedCity=null,this.selectedState=null,this.selectedCountry=null,this.offset=5,this.range=5,this.startDateIndex=42,this.endDateIndex=chartDates.length-1,this.charts=[],this.locationRoot=vm,ko.track(this)}return ChartGroup.prototype.getSupportedCharts=function(){var _this=this;return supportedCharts.filter((function(x){return!_this.charts.some((function(y){return y.key==x.key}))}))},ChartGroup.prototype.addChart=function(key,name){var location=this.getSelectedLocation(),data=location.GetData(key,this),endDateIndex=this.endDateIndex;(this.endDateIndex<this.startDateIndex||this.endDateIndex-this.startDateIndex>=data.length)&&(endDateIndex=data.length-1,this.endDateIndex<0&&(this.endDateIndex=endDateIndex)),this.charts.push(new MyChart(key,name,location,this))},ChartGroup.prototype.removeChart=function(chart){this.charts.remove(chart),this.charts.length||this.locationRoot.chartGroups.remove(this)},ChartGroup.prototype.updateCharts=function(){var _this=this,_a,location=this.getSelectedLocation();(null===(_a=this.charts)||void 0===_a?void 0:_a.length)&&this.charts.forEach((function(x){x.update(location,_this)}))},ChartGroup.prototype.getSelectedLocation=function(){var _a,_b,_c;return this.selectedCountry=this.locationRoot.children[this.selectedCountryName],this.selectedState=this.selectedCountry.children[this.selectedStateName],this.selectedCity=null===(_a=this.selectedState)||void 0===_a?void 0:_a.children[this.selectedCityName],null!==(_c=null!==(_b=this.selectedCity)&&void 0!==_b?_b:this.selectedState)&&void 0!==_c?_c:this.selectedCountry},ChartGroup}(),supportedCharts=[{name:"Total Confirmed",key:"confirmed"},{name:"Total Fatal",key:"fatality"}],chartDates,ViewModel;return new(function(){function ViewModel(){this.children={},this.chartGroups=[],this.names=[],this.lastID=0,this.countdown=3,this.selectedTab="Basic",this.temp="2",this.dates=chartDates,this.getDates(),this.getData(),ko.track(this),ko.applyBindings(this)}return ViewModel.prototype.addGroup=function(){var chartGroup=new ChartGroup(this);return chartGroup.selectedCountryName="US",this.chartGroups.push(chartGroup),chartGroup},ViewModel.prototype.addLocation=function(location,dataKey){var key=location.key.split(", ").reverse().filter((function(x){return x})),i,parent=this,parentKey="";for(i=0;i<key.length-1;i++)parentKey=parentKey?key[i]+", "+parentKey:key[i],parent.children[key[i]]||(parent.names.push(key[i]),parent.children[key[i]]=new MyLocation(parentKey.split(", "))),parent=parent.children[key[i]];parent.names.push(key[i]),parent.children[key[i]]?(parent.children[key[i]].data[dataKey]=location.data[dataKey],parent.children[key[i]].dataKeys.push(dataKey),parent.children[key[i]].population||(parent.children[key[i]].population=location.population)):parent.children[key[i]]=location},ViewModel.prototype.addLocations=function(csv,dataKey,indexes){var _this=this;csv.split("\n").slice(1).filter((function(x){return x})).forEach((function(data){var location=new MyLocation(_this.getLocationData(data),dataKey,indexes);_this.addLocation(location,dataKey)}))},ViewModel.prototype.getShareLink=function(){var query=this.chartGroups.map((function(x){var _a,_b,charts=x.charts.map((function(y){return y.key+"]"+y.name})).join(","),location=null!==(_b=null!==(_a=x.selectedCity)&&void 0!==_a?_a:x.selectedState)&&void 0!==_b?_b:x.selectedCountry;return charts+"["+(null==location?void 0:location.key)})).join("|");return window.location.origin+window.location.pathname+"?charts="+encodeURIComponent(query)},ViewModel.prototype.getDates=function(){return __awaiter(this,void 0,void 0,(function(){var tempDate;return __generator(this,(function(_a){if(!chartDates){for(chartDates=[],tempDate=moment(new Date("1/22/20"));tempDate<moment();)chartDates.push(tempDate.format("l")),tempDate.add(1,"days");this.dates=chartDates}return[2,chartDates]}))}))},ViewModel.prototype.getData=function(){var _this=this;function getCOVID19JohnsHopkinsData(options,vm){var request=new XMLHttpRequest;request.open("GET",options.url,!0),request.onload=function(e){4===request.readyState&&(200===request.status?(vm.addLocations(request.responseText,options.dataKey,options.indexParams),vm.setup()):console.error(request.statusText))},request.onerror=function(e){console.error(request.statusText),vm.countdown--},request.send(null)}var dataOptions=[{url:confirmedGlobalDataUrl,indexParams:[4,2,3,0,1],dataKey:"confirmed",getData:getCOVID19JohnsHopkinsData},{url:confirmedUSDataUrl,indexParams:[11,8,9,6,7,5],dataKey:"confirmed",getData:getCOVID19JohnsHopkinsData},{url:fatalGlobalDataUrl,indexParams:[4,2,3,0,1],dataKey:"fatality",getData:getCOVID19JohnsHopkinsData},{url:fatalUSDataUrl,indexParams:[12,8,9,6,7,5,11],dataKey:"fatality",getData:getCOVID19JohnsHopkinsData}];this.countdown=dataOptions.length,dataOptions.forEach((function(x){return x.getData(x,_this)}))},ViewModel.prototype.getLocationData=function(locationCSV){var temp=locationCSV.split('"');locationCSV="";for(var i=0;i<temp.length;i++)locationCSV+=i%2?temp[i].replace(/,/g,";"):temp[i];return locationCSV.split(",")},ViewModel.prototype.setup=function(){var _this=this;if(!--this.countdown){var query=new URLSearchParams(window.location.search);if(!query.has("charts")){var chartGroup=this.addGroup();return chartGroup.addChart("confirmed","Total Confirmed"),chartGroup.addChart("fatality","Total Fatal"),this.chartGroups.length}return query.get("charts").split("|").forEach((function(groupStr){var _a,_b=groupStr.split("["),chartsStr=_b[0],locationKey=_b[1],group=_this.addGroup();_a=locationKey.split(", ").reverse(),group.selectedCountryName=_a[0],group.selectedStateName=_a[1],group.selectedCityName=_a[2],chartsStr.split(",").forEach((function(chartStr){var _a=chartStr.split("]"),key=_a[0],name=_a[1];group.addChart(key,name)}))})),this.chartGroups.length}},ViewModel}())}